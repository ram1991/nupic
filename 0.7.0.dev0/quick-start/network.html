<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Network API &#8212; NuPIC 0.7.0.dev0
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0.dev0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Algorithms API" href="algorithms.html" />
    <link rel="prev" title="Online Prediction Framework (OPF)" href="opf.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <img alt="../_images/quickstart.png" class="align-right" src="../_images/quickstart.png" />
<div class="section" id="network-api">
<h1>Network API<a class="headerlink" href="#network-api" title="Permalink to this headline">Â¶</a></h1>
<p>See the <a class="reference external" href="../guides/network.html">Network API Guide</a> for an overview of this API.</p>
<p>Here is the complete program we are going to use as an example. In sections
below, we&#8217;ll break it down into parts and explain what is happening (without
some of the plumbing details).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="kn">from</span> <span class="nn">nupic.engine</span> <span class="k">import</span> <span class="n">Network</span>
<span class="kn">from</span> <span class="nn">nupic.encoders</span> <span class="k">import</span> <span class="n">MultiEncoder</span>
<span class="kn">from</span> <span class="nn">nupic.data.file_record_stream</span> <span class="k">import</span> <span class="n">FileRecordStream</span>

<span class="n">_NUM_RECORDS</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">_EXAMPLE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">_INPUT_FILE_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_EXAMPLE_DIR</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;gymdata.csv&quot;</span><span class="p">)</span>
<span class="n">_PARAMS_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_EXAMPLE_DIR</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;model.yaml&quot;</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">createDataOutLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Link sensor region to other region so that it can pass it data.&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;dataOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bottomUpIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">regionName1</span><span class="p">,</span> <span class="n">regionName2</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create a feed-forward link between 2 regions: regionName1 -&gt; regionName2&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">regionName1</span><span class="p">,</span> <span class="n">regionName2</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;bottomUpOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bottomUpIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createResetLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create a reset link from a sensor region: sensorRegionName -&gt; regionName&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;resetOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;resetIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createSensorToClassifierLinks</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sensorRegionName</span><span class="p">,</span>
                                  <span class="n">classifierRegionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create required links from a sensor region to a classifier region.&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;bucketIdxOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bucketIdxIn&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;actValueOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;actValueIn&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;categoryOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;categoryIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createEncoder</span><span class="p">(</span><span class="n">encoderParams</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create a multi-encoder from params.&quot;&quot;&quot;</span>
  <span class="n">encoder</span> <span class="o">=</span> <span class="n">MultiEncoder</span><span class="p">()</span>
  <span class="n">encoder</span><span class="o">.</span><span class="n">addMultipleEncoders</span><span class="p">(</span><span class="n">encoderParams</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">encoder</span>


<span class="k">def</span> <span class="nf">createNetwork</span><span class="p">(</span><span class="n">dataSource</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create and initialize a network.&quot;&quot;&quot;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_PARAMS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">modelParams</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s2">&quot;modelParams&quot;</span><span class="p">]</span>

  <span class="c1"># Create a network that will hold the regions.</span>
  <span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>

  <span class="c1"># Add a sensor region.</span>
  <span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;py.RecordSensor&quot;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>

  <span class="c1"># Set the encoder and data source of the sensor region.</span>
  <span class="n">sensorRegion</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;sensor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span>
  <span class="n">sensorRegion</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">createEncoder</span><span class="p">(</span><span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;sensorParams&quot;</span><span class="p">][</span><span class="s2">&quot;encoders&quot;</span><span class="p">])</span>
  <span class="n">sensorRegion</span><span class="o">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span>

  <span class="c1"># Make sure the SP input width matches the sensor region output width.</span>
  <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;spParams&quot;</span><span class="p">][</span><span class="s2">&quot;inputWidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensorRegion</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">getWidth</span><span class="p">()</span>

  <span class="c1"># Add SP and TM regions.</span>
  <span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;py.SPRegion&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;spParams&quot;</span><span class="p">]))</span>
  <span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s2">&quot;py.TMRegion&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;tmParams&quot;</span><span class="p">]))</span>

  <span class="c1"># Add a classifier region.</span>
  <span class="n">clName</span> <span class="o">=</span> <span class="s2">&quot;py.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;clParams&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;regionName&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">clName</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;clParams&quot;</span><span class="p">]))</span>

  <span class="c1"># Add all links</span>
  <span class="n">createSensorToClassifierLinks</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">)</span>
  <span class="n">createDataOutLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;SP&quot;</span><span class="p">)</span>
  <span class="n">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;TM&quot;</span><span class="p">)</span>
  <span class="n">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">)</span>
  <span class="c1"># Reset links are optional, since the sensor region does not send resets.</span>
  <span class="n">createResetLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;SP&quot;</span><span class="p">)</span>
  <span class="n">createResetLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;TM&quot;</span><span class="p">)</span>

  <span class="c1"># Make sure all objects are initialized.</span>
  <span class="n">network</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">network</span>


<span class="k">def</span> <span class="nf">getPredictionResults</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">clRegionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Get prediction results for all prediction steps.&quot;&quot;&quot;</span>
  <span class="n">classifierRegion</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">clRegionName</span><span class="p">]</span>
  <span class="n">actualValues</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;actualValues&quot;</span><span class="p">)</span>
  <span class="n">probabilities</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;probabilities&quot;</span><span class="p">)</span>
  <span class="n">steps</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span><span class="o">.</span><span class="n">stepsList</span>
  <span class="n">N</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span><span class="o">.</span><span class="n">maxCategoryCount</span>
  <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">step</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">}</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)):</span>
    <span class="c1"># stepProbabilities are probabilities for this prediction step only.</span>
    <span class="n">stepProbabilities</span> <span class="o">=</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">N</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">mostLikelyCategoryIdx</span> <span class="o">=</span> <span class="n">stepProbabilities</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
    <span class="n">predictedValue</span> <span class="o">=</span> <span class="n">actualValues</span><span class="p">[</span><span class="n">mostLikelyCategoryIdx</span><span class="p">]</span>
    <span class="n">predictionConfidence</span> <span class="o">=</span> <span class="n">stepProbabilities</span><span class="p">[</span><span class="n">mostLikelyCategoryIdx</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;predictedValue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictedValue</span>
    <span class="n">results</span><span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;predictionConfidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictionConfidence</span>
  <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">runHotgym</span><span class="p">(</span><span class="n">numRecords</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Run the Hot Gym example.&quot;&quot;&quot;</span>

  <span class="c1"># Create a data source for the network.</span>
  <span class="n">dataSource</span> <span class="o">=</span> <span class="n">FileRecordStream</span><span class="p">(</span><span class="n">streamID</span><span class="o">=</span><span class="n">_INPUT_FILE_PATH</span><span class="p">)</span>
  <span class="n">numRecords</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">numRecords</span><span class="p">,</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">getDataRowCount</span><span class="p">())</span>
  <span class="n">network</span> <span class="o">=</span> <span class="n">createNetwork</span><span class="p">(</span><span class="n">dataSource</span><span class="p">)</span>

  <span class="c1"># Set predicted field index. It needs to be the same index as the data source.</span>
  <span class="n">predictedIdx</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">getFieldNames</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;consumption&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;sensor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;predictedFieldIdx&quot;</span><span class="p">,</span> <span class="n">predictedIdx</span><span class="p">)</span>

  <span class="c1"># Enable learning for all regions.</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;SP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;TM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Enable inference for all regions.</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;SP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;TM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Run the network, N iterations at a time.</span>
  <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numRecords</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">network</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

    <span class="n">predictionResults</span> <span class="o">=</span> <span class="n">getPredictionResults</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">)</span>
    <span class="n">oneStep</span> <span class="o">=</span> <span class="n">predictionResults</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;predictedValue&quot;</span><span class="p">]</span>
    <span class="n">oneStepConfidence</span> <span class="o">=</span> <span class="n">predictionResults</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;predictionConfidence&quot;</span><span class="p">]</span>
    <span class="n">fiveStep</span> <span class="o">=</span> <span class="n">predictionResults</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s2">&quot;predictedValue&quot;</span><span class="p">]</span>
    <span class="n">fiveStepConfidence</span> <span class="o">=</span> <span class="n">predictionResults</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s2">&quot;predictionConfidence&quot;</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">oneStep</span><span class="p">,</span> <span class="n">oneStepConfidence</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
              <span class="n">fiveStep</span><span class="p">,</span> <span class="n">fiveStepConfidence</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;1-step: </span><span class="si">{:16}</span><span class="s2"> (</span><span class="si">{:4.4}</span><span class="s2">%)</span><span class="se">\t</span><span class="s2"> 5-step: </span><span class="si">{:16}</span><span class="s2"> (</span><span class="si">{:4.4}</span><span class="s2">%)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">results</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">runHotgym</span><span class="p">(</span><span class="n">_NUM_RECORDS</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="network-parameters">
<h2>Network Parameters<a class="headerlink" href="#network-parameters" title="Permalink to this headline">Â¶</a></h2>
<p>Before you can create an HTM network, you need to have model (or network) parameters
defined in a file. These model parameters contain many details about how the HTM
network will be constructed, what encoder configurations will be used, and
individual algorithm parameters that can drastically affect how a model
operates. The model parameters we&#8217;re using in this Quick Start
<a class="reference external" href="example-model-params.html">can be found here</a>.</p>
<p>To use model parameters, they can be written to a file and imported into
your script. In this example, our model parameters existing in a
<a class="reference external" href="http://yaml.org/">YAML</a> file called <code class="docutils literal"><span class="pre">params.yaml</span></code> and are identical to
those <a class="reference external" href="example-model-params.html">linked above</a>.</p>
<p>To import the model params from a YAML file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">_PARAMS_PATH</span> <span class="o">=</span> <span class="s2">&quot;/path/to/model.yaml&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_PARAMS_PATH</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">modelParams</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s2">&quot;modelParams&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The dictionary <code class="docutils literal"><span class="pre">modelParams</span></code> is what you will use to parametrize your
HTM network. We&#8217;ll do that in the next sections of this example.</p>
</div>
<div class="section" id="create-a-network">
<h2>Create a Network<a class="headerlink" href="#create-a-network" title="Permalink to this headline">Â¶</a></h2>
<p>Create an HTM network with <a class="reference internal" href="../api/network/network.html#nupic.engine.Network" title="nupic.engine.Network"><code class="xref py py-class docutils literal"><span class="pre">Network</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nupic.engine</span> <span class="k">import</span> <span class="n">Network</span>

<span class="c1"># A network that will hold the regions.</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">Network</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we need to add several regions to this network:</p>
<ul class="simple">
<li>Sensor Region</li>
<li>Spatial Pooler Region</li>
<li>Temporal Memory Region</li>
<li>Classifier Region</li>
</ul>
<p>The regions will be linked serially. In the next sections, we&#8217;ll cover how to
create regions with the right parameters and how to link them.</p>
</div>
<div class="section" id="add-a-sensor-region">
<h2>Add a Sensor Region<a class="headerlink" href="#add-a-sensor-region" title="Permalink to this headline">Â¶</a></h2>
<p>Let&#8217;s add a region of type <a class="reference internal" href="../api/network/sensors.html#nupic.regions.RecordSensor.RecordSensor" title="nupic.regions.RecordSensor.RecordSensor"><code class="xref py py-class docutils literal"><span class="pre">RecordSensor</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;py.RecordSensor&quot;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This region is in charge of sensing the input data. It does not require any
particular parameters (hence the <code class="docutils literal"><span class="pre">'{}'</span></code>) but it does need a Data Source
as well as an Encoder. We&#8217;ll add that next.</p>
</div>
<div class="section" id="add-a-data-source-to-the-sensor-region">
<h2>Add a Data Source to the Sensor Region<a class="headerlink" href="#add-a-data-source-to-the-sensor-region" title="Permalink to this headline">Â¶</a></h2>
<p>A data source is in charge of producing the data that will be fed to the HTM
network. You can create a data source that reads from a CSV file
with <a class="reference internal" href="../api/data/index.html#nupic.data.file_record_stream.FileRecordStream" title="nupic.data.file_record_stream.FileRecordStream"><code class="xref py py-class docutils literal"><span class="pre">FileRecordStream</span></code></a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nupic.data.file_record_stream</span> <span class="k">import</span> <span class="n">FileRecordStream</span>

<span class="n">_INPUT_FILE_PATH</span> <span class="o">=</span> <span class="s2">&quot;/path/to/your/data.csv&quot;</span>
<span class="n">dataSource</span> <span class="o">=</span> <span class="n">FileRecordStream</span><span class="p">(</span><span class="n">streamID</span><span class="o">=</span><span class="n">_INPUT_FILE_PATH</span><span class="p">)</span>

<span class="c1"># Add the data source to the sensor region.</span>
<span class="n">sensorRegion</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;sensor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span>
<span class="n">sensorRegion</span><span class="o">.</span><span class="n">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The input CSV needs to have specific headers.
More details <a class="reference external" href="example-data.html">here</a>.</p>
</div>
</div>
<div class="section" id="add-an-encoder-to-the-sensor-region">
<h2>Add an Encoder to the Sensor Region<a class="headerlink" href="#add-an-encoder-to-the-sensor-region" title="Permalink to this headline">Â¶</a></h2>
<p>Our <a class="reference external" href="example-model-params.html">model parameters</a> define how this data will be
encoded in the <code class="docutils literal"><span class="pre">encoders</span></code> section:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># List of encoders and their parameters.</span>
<span class="n">encoders</span><span class="p">:</span>
  <span class="n">consumption</span><span class="p">:</span>
    <span class="n">fieldname</span><span class="p">:</span> <span class="n">consumption</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">consumption</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="mf">0.88</span>
    <span class="n">seed</span><span class="p">:</span> <span class="mi">1</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">RandomDistributedScalarEncoder</span>
  <span class="n">timestamp_timeOfDay</span><span class="p">:</span>
    <span class="n">fieldname</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">timestamp_timeOfDay</span>
    <span class="n">timeOfDay</span><span class="p">:</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DateEncoder</span>
  <span class="n">timestamp_weekend</span><span class="p">:</span>
    <span class="n">fieldname</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">timestamp_weekend</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DateEncoder</span>
    <span class="n">weekend</span><span class="p">:</span> <span class="mi">21</span>
</pre></div>
</div>
<p>Notice that three semantic values are being encoded into the input space. The
first is the scalar energy <code class="docutils literal"><span class="pre">consumption</span></code> value, which is being encoded with
the <a class="reference internal" href="../api/algorithms/encoders.html#nupic.encoders.random_distributed_scalar.RandomDistributedScalarEncoder" title="nupic.encoders.random_distributed_scalar.RandomDistributedScalarEncoder"><code class="xref py py-class docutils literal"><span class="pre">RandomDistributedScalarEncoder</span></code></a>. The next two values represent two
different aspects of time using the <a class="reference internal" href="../api/algorithms/encoders.html#nupic.encoders.date.DateEncoder" title="nupic.encoders.date.DateEncoder"><code class="xref py py-class docutils literal"><span class="pre">DateEncoder</span></code></a>. The encoder called
<code class="docutils literal"><span class="pre">timestamp_timeOfDay</span></code> encodes the time of day, while the <code class="docutils literal"><span class="pre">timestamp_weekend</span></code>
encoder will output different representations for weekends vs weekdays. The
<a class="reference internal" href="../api/opf/models.html#nupic.frameworks.opf.htm_prediction_model.HTMPredictionModel" title="nupic.frameworks.opf.htm_prediction_model.HTMPredictionModel"><code class="xref py py-class docutils literal"><span class="pre">HTMPredictionModel</span></code></a> will combine these encodings using the
<a class="reference internal" href="../api/algorithms/encoders.html#nupic.encoders.multi.MultiEncoder" title="nupic.encoders.multi.MultiEncoder"><code class="xref py py-class docutils literal"><span class="pre">MultiEncoder</span></code></a>.</p>
<blockquote>
<div>For details about encoding and how these encoders work, see the
<a class="reference external" href="https://numenta.org/htm-school/">HTM School</a> episodes on encoders.</div></blockquote>
<p>Let&#8217;s create an encoder and add it the Sensor Region:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nupic.encoders</span> <span class="k">import</span> <span class="n">MultiEncoder</span>

<span class="k">def</span> <span class="nf">createEncoder</span><span class="p">(</span><span class="n">encoderParams</span><span class="p">):</span>
  <span class="n">encoder</span> <span class="o">=</span> <span class="n">MultiEncoder</span><span class="p">()</span>
  <span class="n">encoder</span><span class="o">.</span><span class="n">addMultipleEncoders</span><span class="p">(</span><span class="n">encoderParams</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">encoder</span>

<span class="c1"># Use the same modelParams extracted from the YAML file earlier.</span>
<span class="n">encoderParams</span> <span class="o">=</span> <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;sensorParams&quot;</span><span class="p">][</span><span class="s2">&quot;encoders&quot;</span><span class="p">]</span>

<span class="c1"># Add encoder to the sensor region.</span>
<span class="n">sensorRegion</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;sensor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span>
<span class="n">sensorRegion</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">createEncoder</span><span class="p">(</span><span class="n">encoderParams</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="add-a-spatial-pooler-region">
<h2>Add a Spatial Pooler Region<a class="headerlink" href="#add-a-spatial-pooler-region" title="Permalink to this headline">Â¶</a></h2>
<p>When creating a region, we always need to make sure that the output width of
the previous region matches the input width of the following region. In the
case of the Spatial Pooler region, the input width was not specified in the
<code class="docutils literal"><span class="pre">modelParams</span></code>, so we need to set it.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">spParams</span> <span class="o">=</span> <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;spParams&quot;</span><span class="p">]</span>

<span class="c1"># Make sure the SP input width matches the sensor output width.</span>
<span class="n">spParams</span><span class="p">[</span><span class="s2">&quot;inputWidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensorRegion</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">getWidth</span><span class="p">()</span>

<span class="c1"># Add SP region.</span>
<span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;py.SPRegion&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">spParams</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="add-a-temporal-memory-region">
<h2>Add a Temporal Memory Region<a class="headerlink" href="#add-a-temporal-memory-region" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tmParams</span> <span class="o">=</span> <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;tmParams&quot;</span><span class="p">]</span>
<span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s2">&quot;py.TPRegion&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tmParams</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="add-a-classifier-region">
<h2>Add a Classifier Region<a class="headerlink" href="#add-a-classifier-region" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clParams</span> <span class="o">=</span> <span class="n">modelParams</span><span class="p">[</span><span class="s2">&quot;clParams&quot;</span><span class="p">]</span>
<span class="n">network</span><span class="o">.</span><span class="n">addRegion</span><span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="s2">&quot;py.SDRClassifierRegion&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">clParams</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="link-all-regions">
<h2>Link all Regions<a class="headerlink" href="#link-all-regions" title="Permalink to this headline">Â¶</a></h2>
<p>Now that we have created all regions, we need to link them together. Links
are responsible for passing information from one region to the next.</p>
<p>First, we&#8217;ll add the link in charge of passing the data from <code class="docutils literal"><span class="pre">sensorRegion</span></code>
to <code class="docutils literal"><span class="pre">spRegion</span></code>. Then we&#8217;ll create 2 <code class="docutils literal"><span class="pre">feedForward</span></code> links: one from the
SP to the TM and another from the TM to the Classifier. Finally, we&#8217;ll add a
couple of special links between <code class="docutils literal"><span class="pre">sensorRegion</span></code> and <code class="docutils literal"><span class="pre">classifierRegion</span></code>.
These links make it possible for the classifier to map predicted cell states
to actual values learned from the input data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">createDataOutLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Link sensor region to other region so that it can pass it data.&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">regionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;dataOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bottomUpIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">regionName1</span><span class="p">,</span> <span class="n">regionName2</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create a feed-forward link between 2 regions: regionName1 -&gt; regionName2&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">regionName1</span><span class="p">,</span> <span class="n">regionName2</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;bottomUpOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bottomUpIn&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">createSensorToClassifierLinks</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Create required links from a sensor region to a classifier region.&quot;&quot;&quot;</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;bucketIdxOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;bucketIdxIn&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;actValueOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;actValueIn&quot;</span><span class="p">)</span>
  <span class="n">network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sensorRegionName</span><span class="p">,</span> <span class="n">classifierRegionName</span><span class="p">,</span> <span class="s2">&quot;UniformLink&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">srcOutput</span><span class="o">=</span><span class="s2">&quot;categoryOut&quot;</span><span class="p">,</span> <span class="n">destInput</span><span class="o">=</span><span class="s2">&quot;categoryIn&quot;</span><span class="p">)</span>


<span class="c1"># 1. Add data link between sensor and SP.</span>
<span class="n">createDataOutLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;SP&quot;</span><span class="p">)</span>

<span class="c1"># 2. Add feed forward links.</span>
<span class="n">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;TM&quot;</span><span class="p">)</span>
<span class="n">createFeedForwardLink</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;TM&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">)</span>

<span class="c1"># 3. Add links between sensor and classifier.</span>
<span class="n">createSensorToClassifierLinks</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="section" id="set-the-predicted-field-index">
<h2>Set the Predicted Field Index<a class="headerlink" href="#set-the-predicted-field-index" title="Permalink to this headline">Â¶</a></h2>
<p>To be able to make predictions, the network needs to know what field we want
to predict. So let&#8217;s set the predicted field index.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">predictedIdx</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">getFieldNames</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;consumption&quot;</span><span class="p">)</span>

<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;sensor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;predictedFieldIdx&quot;</span><span class="p">,</span> <span class="n">predictedIdx</span><span class="p">)</span>
</pre></div>
</div>
<p>Make sure that the predicted field index that you are passing to the classifier
region is using the same indexing as the data source. This is the role of the
first line in the code snippet above.</p>
</div>
<div class="section" id="enable-learning-and-inference">
<h2>Enable Learning and Inference<a class="headerlink" href="#enable-learning-and-inference" title="Permalink to this headline">Â¶</a></h2>
<p>If you want the network to learn on the input data, you need to enable learning.
Note that enabling learning is independent from enabling inference. So if you
want the network to output predictions, you need to enable inference as well.
Let&#8217;s enable both in our case, because we want the network to learn and make predictions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Enable learning for all regions.</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;SP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;TM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;learningMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Enable inference for all regions.</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;SP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;TM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="s2">&quot;inferenceMode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-network">
<h2>Run the Network<a class="headerlink" href="#run-the-network" title="Permalink to this headline">Â¶</a></h2>
<p>Before running the network, you need to initialize it. After that, you can run
the network <code class="docutils literal"><span class="pre">N</span></code> iterations at a time.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Make sure all objects are initialized.</span>
<span class="n">network</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Run the network, N iterations at a time.</span>
<span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numRecords</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
  <span class="n">network</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we run the network <code class="docutils literal"><span class="pre">1</span></code> iteration at a time because we want to extract
the prediction results at each time step.</p>
</div>
<div class="section" id="getting-predictions">
<h2>Getting Predictions<a class="headerlink" href="#getting-predictions" title="Permalink to this headline">Â¶</a></h2>
<p>In the classifier configuration of our <a class="reference external" href="example-model-params.html">model parameters</a>,
identified as <code class="docutils literal"><span class="pre">modelParams.clParams</span></code>, the <code class="docutils literal"><span class="pre">steps</span></code> value tells the model how
many steps into the future to predict. In this case, we are predicting both one
and five steps into the future as shown by the value <code class="docutils literal"><span class="pre">1,5</span></code>.</p>
<p>You can use the method <code class="docutils literal"><span class="pre">getOuputData()</span></code> to get output predictions from the
classifier region. In our case, we are interested in:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">actualValues</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;actualValues&quot;</span><span class="p">)</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;probabilities&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Refer to the documentation of <a class="reference internal" href="../api/network/regions.html#nupic.regions.SDRClassifierRegion.SDRClassifierRegion" title="nupic.regions.SDRClassifierRegion.SDRClassifierRegion"><code class="xref py py-class docutils literal"><span class="pre">SDRClassifierRegion</span></code></a> for
more information about output values and their structure.</p>
<p>We&#8217;ll use the helper function below to extract predictions more easily from
the classifier region:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getPredictionResults</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">clRegionName</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Helper function to extract results for all prediction steps.&quot;&quot;&quot;</span>


  <span class="n">classifierRegion</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">clRegionName</span><span class="p">]</span>
  <span class="n">actualValues</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;actualValues&quot;</span><span class="p">)</span>
  <span class="n">probabilities</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getOutputData</span><span class="p">(</span><span class="s2">&quot;probabilities&quot;</span><span class="p">)</span>
  <span class="n">steps</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span><span class="o">.</span><span class="n">stepsList</span>

  <span class="n">N</span> <span class="o">=</span> <span class="n">classifierRegion</span><span class="o">.</span><span class="n">getSelf</span><span class="p">()</span><span class="o">.</span><span class="n">maxCategoryCount</span>
  <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="n">step</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">}</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">)):</span>
    <span class="c1"># stepProbabilities are probabilities for this prediction step only.</span>
    <span class="n">stepProbabilities</span> <span class="o">=</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">N</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">mostLikelyCategoryIdx</span> <span class="o">=</span> <span class="n">stepProbabilities</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>
    <span class="n">predictedValue</span> <span class="o">=</span> <span class="n">actualValues</span><span class="p">[</span><span class="n">mostLikelyCategoryIdx</span><span class="p">]</span>
    <span class="n">predictionConfidence</span> <span class="o">=</span> <span class="n">stepProbabilities</span><span class="p">[</span><span class="n">mostLikelyCategoryIdx</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;predictedValue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictedValue</span>
    <span class="n">results</span><span class="p">[</span><span class="n">steps</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;predictionConfidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictionConfidence</span>
  <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
<p>Once you put all this together and run the <a class="reference external" href="network.html">full example</a>,
you can see both predictions and their confidences in the console output,
which should look something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>    <span class="mf">45.6100006104</span> <span class="p">(</span><span class="mf">96.41</span><span class="o">%</span><span class="p">)</span>   <span class="mi">5</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>              <span class="mf">0.0</span> <span class="p">(</span><span class="mf">0.1883</span><span class="o">%</span><span class="p">)</span>
<span class="mi">1</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>    <span class="mf">43.4000015259</span> <span class="p">(</span><span class="mf">3.969</span><span class="o">%</span><span class="p">)</span>   <span class="mi">5</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>              <span class="mf">0.0</span> <span class="p">(</span><span class="mf">0.1883</span><span class="o">%</span><span class="p">)</span>
<span class="mi">1</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>    <span class="mf">43.4000015259</span> <span class="p">(</span><span class="mf">4.125</span><span class="o">%</span><span class="p">)</span>   <span class="mi">5</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>              <span class="mf">0.0</span> <span class="p">(</span><span class="mf">0.1883</span><span class="o">%</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Congratulations! You&#8217;ve got HTM predictions for a scalar data stream!</strong></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/numenta-logo.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">NuPIC</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=numenta&repo=nupic&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Quick Start</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#install-nupic">Install NuPIC</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#choose-your-api">Choose Your API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="opf.html">Online Prediction Framework (OPF)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Network API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#network-parameters">Network Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-network">Create a Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-sensor-region">Add a Sensor Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-data-source-to-the-sensor-region">Add a Data Source to the Sensor Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-an-encoder-to-the-sensor-region">Add an Encoder to the Sensor Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-spatial-pooler-region">Add a Spatial Pooler Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-temporal-memory-region">Add a Temporal Memory Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#add-a-classifier-region">Add a Classifier Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="#link-all-regions">Link all Regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-the-predicted-field-index">Set the Predicted Field Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-learning-and-inference">Enable Learning and Inference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-network">Run the Network</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-predictions">Getting Predictions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="algorithms.html">Algorithms API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Numenta.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/quick-start/network.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/numenta/nupic" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>